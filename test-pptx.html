<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Rapide G√©n√©rateur PowerPoint</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, sans-serif; 
      max-width: 800px; 
      margin: 40px auto; 
      padding: 20px;
      background: #f5f5f5;
    }
    .test-container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 5px;
      font-size: 16px;
    }
    button:hover { background: #0056b3; }
    .result { 
      margin-top: 20px; 
      padding: 15px; 
      border-radius: 5px;
      display: none;
    }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    pre { 
      background: #f8f9fa; 
      padding: 10px; 
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üß™ Test Rapide du G√©n√©rateur PowerPoint</h1>
    
    <h2>Tests disponibles:</h2>
    
    <button onclick="testLibraryLoading()">1. Tester le chargement de PptxGenJS</button>
    <button onclick="testJSONValidation()">2. Tester la validation JSON</button>
    <button onclick="testTableValidation()">3. Tester la validation des tables</button>
    <button onclick="testGenerationSimple()">4. Tester la g√©n√©ration simple</button>
    <button onclick="testProgressiveFeedback()">5. Tester le feedback progressif</button>
    
    <div id="result" class="result"></div>
    
    <h2>Console de test:</h2>
    <pre id="console"></pre>
  </div>

  <script>
    const resultDiv = document.getElementById('result');
    const consoleDiv = document.getElementById('console');
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      consoleDiv.textContent += `[${timestamp}] ${message}\n`;
      console.log(message);
    }
    
    function showResult(message, type = 'info') {
      resultDiv.className = `result ${type}`;
      resultDiv.textContent = message;
      resultDiv.style.display = 'block';
    }
    
    // Test 1: V√©rifier le chargement de la biblioth√®que
    function testLibraryLoading() {
      log('Test 1: V√©rification du chargement de PptxGenJS...');
      
      // V√©rifier si PptxGenJS est disponible
      if (typeof window.PptxGenJS !== 'undefined') {
        showResult('‚úÖ PptxGenJS est charg√© correctement!', 'success');
        log('PptxGenJS version d√©tect√©e: ' + (window.PptxGenJS.version || 'inconnue'));
      } else if (typeof window.pptxgen !== 'undefined') {
        showResult('‚úÖ pptxgen est charg√© correctement!', 'success');
        log('pptxgen d√©tect√© (format alternatif)');
      } else {
        showResult('‚ùå PptxGenJS n\'est pas charg√©!', 'error');
        log('Erreur: Aucune biblioth√®que PptxGenJS d√©tect√©e');
        
        // Essayer de charger le fichier
        log('Tentative de chargement du fichier pptxgen.bundle.js...');
        const script = document.createElement('script');
        script.src = './pptxgen.bundle.js';
        script.onload = () => {
          log('Fichier pptxgen.bundle.js charg√© avec succ√®s');
          showResult('‚úÖ PptxGenJS charg√© apr√®s correction!', 'success');
        };
        script.onerror = () => {
          log('Erreur: Impossible de charger pptxgen.bundle.js');
          showResult('‚ùå Impossible de charger pptxgen.bundle.js', 'error');
        };
        document.head.appendChild(script);
      }
    }
    
    // Test 2: Validation JSON
    function testJSONValidation() {
      log('Test 2: Validation JSON...');
      
      const validJSON = {
        metadata: {
          title: "Test Pr√©sentation",
          fileName: "test-presentation.pptx",
          author: "Testeur"
        },
        slides: [
          {
            type: "title",
            title: "Titre de Test",
            subtitle: "Sous-titre de test"
          },
          {
            type: "content",
            title: "Contenu de Test",
            bullets: [
              "Premier point",
              "Deuxi√®me point",
              "Troisi√®me point"
            ]
          }
        ]
      };
      
      const invalidJSON = {
        metadata: {
          title: "", // Titre vide
          fileName: "Test avec Espaces.pptx" // Nom invalide
        },
        slides: [] // Pas de slides
      };
      
      try {
        // Test avec JSON valide
        log('Test avec JSON valide...');
        const validStr = JSON.stringify(validJSON, null, 2);
        log('JSON valide cr√©√© avec succ√®s');
        
        // Test avec JSON invalide
        log('Test avec JSON invalide...');
        const invalidStr = JSON.stringify(invalidJSON, null, 2);
        log('JSON invalide cr√©√© pour test');
        
        showResult('‚úÖ Tests de validation JSON pass√©s!', 'success');
      } catch (error) {
        showResult('‚ùå Erreur dans les tests JSON: ' + error.message, 'error');
        log('Erreur: ' + error.message);
      }
    }
    
    // Test 3: Validation des tables
    function testTableValidation() {
      log('Test 3: Validation des tables...');
      
      const validTable = [
        ["En-t√™te 1", "En-t√™te 2", "En-t√™te 3"],
        ["Donn√©e 1", "Donn√©e 2", "Donn√©e 3"],
        ["Donn√©e 4", "Donn√©e 5", "Donn√©e 6"]
      ];
      
      const invalidTables = [
        [], // Table vide
        [null], // Premi√®re ligne null
        [["Header"]], // Une seule colonne
        [[]], // En-t√™te vide
        [["A", "B"], ["C"]] // Nombre de colonnes incoh√©rent
      ];
      
      let testsPass√©s = 0;
      let totalTests = invalidTables.length + 1;
      
      // Test table valide
      if (Array.isArray(validTable) && validTable.length > 0 && Array.isArray(validTable[0])) {
        testsPass√©s++;
        log('‚úì Table valide reconnue');
      }
      
      // Test tables invalides
      invalidTables.forEach((table, index) => {
        if (!Array.isArray(table) || table.length === 0 || !Array.isArray(table[0]) || table[0].length === 0) {
          testsPass√©s++;
          log(`‚úì Table invalide ${index + 1} correctement d√©tect√©e`);
        } else {
          log(`‚úó Table invalide ${index + 1} non d√©tect√©e`);
        }
      });
      
      if (testsPass√©s === totalTests) {
        showResult(`‚úÖ Tous les tests de validation de tables pass√©s! (${testsPass√©s}/${totalTests})`, 'success');
      } else {
        showResult(`‚ö†Ô∏è Tests partiellement r√©ussis: ${testsPass√©s}/${totalTests}`, 'info');
      }
    }
    
    // Test 4: G√©n√©ration simple
    async function testGenerationSimple() {
      log('Test 4: G√©n√©ration simple de PowerPoint...');
      
      // D'abord charger PptxGenJS si n√©cessaire
      if (typeof window.PptxGenJS === 'undefined' && typeof window.pptxgen === 'undefined') {
        log('Chargement de PptxGenJS...');
        await new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = './pptxgen.bundle.js';
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        }).catch(err => {
          showResult('‚ùå Impossible de charger PptxGenJS', 'error');
          return;
        });
      }
      
      try {
        const PptxGenJS = window.PptxGenJS || window.pptxgen;
        const pptx = new PptxGenJS();
        
        pptx.layout = 'LAYOUT_16x9';
        pptx.author = 'Test';
        pptx.title = 'Test de G√©n√©ration';
        
        // Slide 1: Titre
        const slide1 = pptx.addSlide();
        slide1.addText('Test de G√©n√©ration PowerPoint', {
          x: 1, y: 2, w: 8, h: 2,
          fontSize: 36, bold: true, align: 'center'
        });
        
        // Slide 2: Contenu
        const slide2 = pptx.addSlide();
        slide2.addText('Slide de Test', {
          x: 0.5, y: 0.5, w: 9, h: 1,
          fontSize: 24, bold: true
        });
        slide2.addText([
          { text: 'Premier point', options: { bullet: true } },
          { text: 'Deuxi√®me point', options: { bullet: true } },
          { text: 'Troisi√®me point', options: { bullet: true } }
        ], {
          x: 0.5, y: 1.5, w: 9, h: 4
        });
        
        log('Pr√©sentation cr√©√©e, g√©n√©ration du fichier...');
        
        await pptx.writeFile({ fileName: 'test-simple.pptx' });
        
        showResult('‚úÖ Fichier PowerPoint g√©n√©r√© avec succ√®s: test-simple.pptx', 'success');
        log('Fichier g√©n√©r√©: test-simple.pptx');
      } catch (error) {
        showResult('‚ùå Erreur lors de la g√©n√©ration: ' + error.message, 'error');
        log('Erreur: ' + error.message);
      }
    }
    
    // Test 5: Feedback progressif
    async function testProgressiveFeedback() {
      log('Test 5: Test du feedback progressif...');
      
      const totalSteps = 10;
      showResult('G√©n√©ration en cours...', 'info');
      
      for (let i = 1; i <= totalSteps; i++) {
        log(`√âtape ${i}/${totalSteps}...`);
        resultDiv.textContent = `G√©n√©ration en cours... ${i}/${totalSteps}`;
        
        // Simuler un d√©lai pour voir la progression
        await new Promise(resolve => setTimeout(resolve, 200));
      }
      
      showResult('‚úÖ Test du feedback progressif termin√©!', 'success');
      log('Feedback progressif compl√©t√©');
    }
    
    // Charger automatiquement PptxGenJS au chargement de la page
    window.addEventListener('DOMContentLoaded', () => {
      log('Page de test charg√©e');
      log('Tentative de chargement automatique de PptxGenJS...');
      
      const script = document.createElement('script');
      script.src = './pptxgen.bundle.js';
      script.onload = () => {
        log('‚úì PptxGenJS charg√© automatiquement');
      };
      script.onerror = () => {
        log('‚ö†Ô∏è √âchec du chargement automatique de PptxGenJS');
      };
      document.head.appendChild(script);
    });
  </script>
</body>
</html>